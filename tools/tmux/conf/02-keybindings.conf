### ======== PREFIX & KEYBINDINGS ========
## =======================================

unbind C-b
set -g prefix `
bind ` send-prefix
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Reloaded: ~/.config/tmux/tmux.conf"
set -g base-index 1
set -g pane-base-index 1

### ======== COPY MODE & KEYBINDINGS ========
## ==========================================

setw -g mode-keys vi
bind f command-prompt -p "Search:" "copy-mode \; send -X search-forward '%%'"
bind-key v copy-mode
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-selection

### ======== WINDOW & SESSION MANAGEMENT ========
## ==============================================

unbind p
bind N previous-window
bind R command-prompt "rename-window %%"
bind c new-window -c "#{pane_current_path}"
set-option -g renumber-windows on
bind W confirm-before -p "Kill window #{window_index}? (y/n)" kill-window
bind X confirm-before -p "Kill session #{session_name}? (y/n)" kill-session

### ======== SCROLL REFINEMENTS ========
## =====================================
## mouse + keyboard scroll behaviour in copy-mode and from normal mode

## fine-grained mouse wheel scrolling in copy-mode (1 line per tick)
bind-key -T copy-mode-vi WheelUpPane   send -N 1 -X scroll-up   # wheel up = 1 line up
bind-key -T copy-mode-vi WheelDownPane send -N 1 -X scroll-down # wheel down = 1 line down

## from normal mode: first wheel action enters copy-mode, then scrolls 1 line
bind-key -n WheelUpPane if-shell -F "#{pane_in_mode}" \
  "send -N 1 -X scroll-up" \
  "copy-mode -e; send -N 1 -X scroll-up"
bind-key -n WheelDownPane if-shell -F "#{pane_in_mode}" \
  "send -N 1 -X scroll-down" \
  "send -N 1 -X scroll-down"

## keyboard micro-scroll in copy-mode
bind-key -T copy-mode-vi C-y send -N 1 -X scroll-up   # ctrl + y: 1 line up
bind-key -T copy-mode-vi C-e send -N 1 -X scroll-down # ctrl + e: 1 line down

## ----- BIGGER STEPS WITH MODIFIERS (MOUSE) -----
## shift + wheel = 2 lines per tick
## ctrl  + wheel = 5 lines per tick
## alt   + wheel = full page up / down
bind-key -T copy-mode-vi S-WheelUpPane   send -N 2 -X scroll-up   # shift + wheel: 2 lines up
bind-key -T copy-mode-vi S-WheelDownPane send -N 2 -X scroll-down # shift + wheel: 2 lines down
bind-key -T copy-mode-vi C-WheelUpPane   send -N 5 -X scroll-up   # ctrl  + wheel: 5 lines up
bind-key -T copy-mode-vi C-WheelDownPane send -N 5 -X scroll-down # ctrl  + wheel: 5 lines down
bind-key -T copy-mode-vi M-WheelUpPane   send -X page-up          # alt   + wheel: page up
bind-key -T copy-mode-vi M-WheelDownPane send -X page-down        # alt   + wheel: page down

## from normal mode: modifier+wheel auto-enters copy-mode, then applies the big step
bind-key -n S-WheelUpPane if-shell -F "#{pane_in_mode}" \
  "send -N 5 -X scroll-up" \
  "copy-mode -e; send -N 5 -X scroll-up"
bind-key -n S-WheelDownPane if-shell -F "#{pane_in_mode}" \
  "send -N 5 -X scroll-down" \
  "copy-mode -e; send -N 5 -X scroll-down"

bind-key -n C-WheelUpPane if-shell -F "#{pane_in_mode}" \
  "send -N 20 -X scroll-up" \
  "copy-mode -e; send -N 20 -X scroll-up"
bind-key -n C-WheelDownPane if-shell -F "#{pane_in_mode}" \
  "send -N 20 -X scroll-down" \
  "copy-mode -e; send -N 20 -X scroll-down"

bind-key -n M-WheelUpPane if-shell -F "#{pane_in_mode}" \
  "send -X page-up" \
  "copy-mode -e; send -X page-up"
bind-key -n M-WheelDownPane if-shell -F "#{pane_in_mode}" \
  "send -X page-down" \
  "copy-mode -e; send -X page-down"

## ----- BIGGER STEPS WITH KEYBOARD (NO MOUSE) -----
## 2-line nudges
bind-key -T copy-mode-vi C-k send -N 2  -X scroll-up   # ctrl + k: 2 lines up
bind-key -T copy-mode-vi C-j send -N 2  -X scroll-down # ctrl + j: 2 lines down

## 20-line nudges
bind-key -T copy-mode-vi C-u send -N 5 -X scroll-up   # ctrl + u: 5 lines up
bind-key -T copy-mode-vi C-d send -N 5 -X scroll-down # ctrl + d: 5 lines down

## native page keys
bind-key -T copy-mode-vi PageUp   send -X page-up   # pageup: page up
bind-key -T copy-mode-vi PageDown send -X page-down # pagedown: page down

## .